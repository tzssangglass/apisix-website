"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[31994],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return h}});var i=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=i.createContext({}),u=function(e){var t=i.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=u(e.components);return i.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},d=i.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=u(n),h=r,m=d["".concat(s,".").concat(h)]||d[h]||p[h]||a;return n?i.createElement(m,o(o({ref:t},c),{},{components:n})):i.createElement(m,o({ref:t},c))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,o=new Array(a);o[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var u=2;u<a;u++)o[u]=n[u];return i.createElement.apply(null,o)}return i.createElement.apply(null,n)}d.displayName="MDXCreateElement"},97826:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return o},contentTitle:function(){return l},metadata:function(){return s},toc:function(){return u},default:function(){return p}});var i=n(87462),r=n(63366),a=(n(67294),n(3905)),o={title:"Plugin"},l=void 0,s={unversionedId:"architecture-design/plugin",id:"architecture-design/plugin",isDocsHomePage:!1,title:"Plugin",description:"\x3c!--",source:"@site/docs/apisix/architecture-design/plugin.md",sourceDirName:"architecture-design",slug:"/architecture-design/plugin",permalink:"/docs/apisix/next/architecture-design/plugin",editUrl:"https://github.com/apache/apisix/edit/master/docs/en/latest/architecture-design/plugin.md",tags:[],version:"current",frontMatter:{title:"Plugin"},sidebar:"docs",previous:{title:"Route",permalink:"/docs/apisix/next/architecture-design/route"},next:{title:"Script",permalink:"/docs/apisix/next/architecture-design/script"}},u=[{value:"Hot Reload",id:"hot-reload",children:[{value:"Hot reload in stand-alone mode",id:"hot-reload-in-stand-alone-mode",children:[]}]}],c={toc:u};function p(e){var t=e.components,n=(0,r.Z)(e,["components"]);return(0,a.kt)("wrapper",(0,i.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"This represents the configuration of the plugins that are executed during the HTTP request/response lifecycle."),(0,a.kt)("p",null,"A ",(0,a.kt)("inlineCode",{parentName:"p"},"Plugin")," configuration can be bound directly to a ",(0,a.kt)("a",{parentName:"p",href:"/docs/apisix/next/architecture-design/route"},(0,a.kt)("inlineCode",{parentName:"a"},"Route")),", a ",(0,a.kt)("a",{parentName:"p",href:"/docs/apisix/next/architecture-design/service"},(0,a.kt)("inlineCode",{parentName:"a"},"Service"))," or a ",(0,a.kt)("a",{parentName:"p",href:"/docs/apisix/next/architecture-design/consumer"},(0,a.kt)("inlineCode",{parentName:"a"},"Consumer")),"."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Note"),": While configuring the same plugin, only one copy of the configuration is valid. The order of precedence is always ",(0,a.kt)("inlineCode",{parentName:"p"},"Consumer")," > ",(0,a.kt)("inlineCode",{parentName:"p"},"Route")," > ",(0,a.kt)("inlineCode",{parentName:"p"},"Service"),"."),(0,a.kt)("p",null,"While ",(0,a.kt)("a",{parentName:"p",href:"/docs/apisix/next/architecture-design/apisix#configuring-apisix"},"configuring APISIX"),", you can declare the Plugins that are supported by the local APISIX node."),(0,a.kt)("p",null,"This acts as a whitelisting mechanism as Plugins that are not in this whitelist will be automatically ignored. So, this feature can be used to temporarily turn off/turn on specific plugins."),(0,a.kt)("p",null,"For adding new plugins based on existing plugins, copy the data in the the ",(0,a.kt)("inlineCode",{parentName:"p"},"plugins")," node from the default configuration file ",(0,a.kt)("inlineCode",{parentName:"p"},"conf/config-default.yaml")," to your configuration file (",(0,a.kt)("inlineCode",{parentName:"p"},"conf/config.yaml"),")."),(0,a.kt)("p",null,"In a request, a Plugin is only executed once. This is true even if it is bound to multiple different objects like Routes and Services."),(0,a.kt)("p",null,"The order in which Plugins are run is determined by its configured priorities:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-lua"},"local _M = {\n    version = 0.1,\n    priority = 0, -- the priority of this plugin will be 0\n    name = plugin_name,\n    schema = schema,\n    metadata_schema = metadata_schema,\n}\n")),(0,a.kt)("p",null,"A Plugin configuration is submitted as part of the Route or Service and is placed under ",(0,a.kt)("inlineCode",{parentName:"p"},"plugins"),". It internally uses the Plugin name as the hash key to hold the configuration items for the different Plugins."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n    ...\n    "plugins": {\n        "limit-count": {\n            "count": 2,\n            "time_window": 60,\n            "rejected_code": 503,\n            "key": "remote_addr"\n        },\n        "prometheus": {}\n    }\n}\n')),(0,a.kt)("p",null,"Not all Plugins have specific configuration items (for example, ",(0,a.kt)("a",{parentName:"p",href:"/docs/apisix/plugins/prometheus/"},"prometheus"),"). In such cases, an empty object identifier can be used."),(0,a.kt)("p",null,"A warn level log as shown below indicates that the request was rejected by the Plugin."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"ip-restriction exits with http status code 403\n")),(0,a.kt)("h2",{id:"hot-reload"},"Hot Reload"),(0,a.kt)("p",null,"APISIX Plugins are hot-loaded."),(0,a.kt)("p",null,"This means that there is no need to restart the service if you add, delete, modify plugins or even if you update the plugin code."),(0,a.kt)("p",null,"To hot-reload, you can send an HTTP request through the ",(0,a.kt)("a",{parentName:"p",href:"/docs/apisix/next/admin-api"},"Admin API"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"curl http://127.0.0.1:9080/apisix/admin/plugins/reload -H 'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1' -X PUT\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Note"),": If a configured Plugin is disabled, then its execution will be skipped."),(0,a.kt)("h3",{id:"hot-reload-in-stand-alone-mode"},"Hot reload in stand-alone mode"),(0,a.kt)("p",null,"For hot-reloading in stand-alone mode, see the plugin related section in ",(0,a.kt)("a",{parentName:"p",href:"/docs/apisix/next/stand-alone"},"stand alone mode"),"."))}p.isMDXComponent=!0}}]);